#! /bin/sh

set -e

if [[ $# -lt 2 ]]; then
  echo "USAGE: <video-file> <audio-file>"
  exit 1
fi

input_video=$1
input_audio=$2

input_video_filename=$(basename "$input_video")
input_video_basename="${input_video_filename%.*}"
input_video_ext=${input_video_filename##*.}

echo
echo ">> Copying video without sound..."
echo
ffmpeg -i "$input_video" -an -vcodec copy "/tmp/nosound.${input_video_ext}"

echo
echo ">> Attaching sound to video..."
echo
mencoder -audiofile "$input_audio" "/tmp/nosound.${input_video_ext}" -ovc x264 -oac copy -o "${input_video_basename}_processed.mp4"

rm "/tmp/nosound.${input_video_ext}"
